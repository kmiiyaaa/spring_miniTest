<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
   
<mapper namespace="com.kmi.miniTest.dao.CartDao">

	<!--  장바구니 추가  -->
	<insert id="addCartDao" parameterType="com.kmi.miniTest.dto.CartDto">
    INSERT INTO cart(cartid, memberid, productid, quantity) 
    VALUES (cart_seq.nextval, #{memberid}, #{productid}, #{quantity})
	</insert>
 	

  <resultMap id="cartWithMemberAndProduct" type="com.kmi.miniTest.dto.CartDto">
     <!-- CartDto 기본 필드 -->
    <id property="cartid" column="cartid"/>
    <result property="memberid" column="memberid"/>
    <result property="productid" column="productid"/>
    <result property="quantity" column="quantity"/>

    <!-- member 매핑 -->
    <association property="memberDto" javaType="com.kmi.miniTest.dto.MemberDto">
        <result property="userid" column="userid"/>
        <result property="membername" column="membername"/>
    </association>

    <!-- product 매핑 -->
     <association property="productDto" javaType="com.kmi.miniTest.dto.ProductDto">
        <id property="productid" column="productid"/>
        <result property="productname" column="productname"/>
        <result property="productprice" column="productprice"/>
        <result property="productstock" column="productstock"/>
        <result property="productimg" column="productimg"/>
    </association>
</resultMap>

    <select id="getCartListDao" parameterType="string" resultMap="cartWithMemberAndProduct">
        SELECT c.cartid, c.memberid, c.productid, c.quantity,
               m.userid, m.membername,
               p.productid, p.productname, p.productprice, p.productimg
        FROM cart c
        JOIN member m ON c.memberid = m.memberid
        JOIN product p ON c.productid = p.productid
        WHERE c.memberid = #{param1}
    </select>

    <!-- 장바구니 삭제 -->
    <delete id="deleteCartDao" >
        DELETE FROM cart WHERE cartid = #{param1}
    </delete>
  

<resultMap id="cartResultMap" type="com.kmi.miniTest.dto.CartDto">
    <id property="cartid" column="cartid"/>
    <result property="memberid" column="memberid"/>
    <result property="productid" column="productid"/>
    <result property="quantity" column="quantity"/>
    <association property="productDto" javaType="com.kmi.miniTest.dto.ProductDto">
        <id property="productid" column="p_id"/>
        <result property="productname" column="productname"/>
        <result property="productprice" column="productprice"/>
    </association>
</resultMap>

  

</mapper>
